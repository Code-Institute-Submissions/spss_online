{% extends "base.html" %}
{% load ticket_extras %}

{% block content %}
    <div class="row">
        <div class="col-md-6">
            {% if user.is_authenticated %}
                <h3 class=" {% if ticket.status == "CLS" %}text-danger{% else %} text-success{% endif %} ">
                        Status: {{ ticket.get_status_display }}</h3>
        </div>
        <div class="col-md-6"><a href="{% url 'tickets-list' %}" class="btn btn-default">Back to My Tickets</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
                {% if user.is_customer or user.is_staff  %}
                    {% if ticket.status != "CLS" %}
                            <a href="{% url 'close-ticket' ticket.id %}" class="btn btn-danger">Close Ticket</a>
                    {% else %}
                        <a href="{% url 'reopen-ticket' ticket.id %}" class="btn btn-danger">Reopen Ticket</a>
                    {% endif %}
                    </div><div class="col-md-6">
                    <a href="{% url 'new-ticket' %}" class="btn btn-primary">Open New Ticket</a>
                {% else %}
                    </div><div class="col-md-6">
                    <p><a href="{% url 'new-ticket' %}" class="btn btn-primary disabled ">Open New Ticket </a>
                        Only active customers can open cases</p>
                {% endif %}

            {% else %}
                <p>You are not logged in</p>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-md-9">
            <h2>Ticket: {{ ticket.subject }}</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md-9">
            <p><b>Product:</b> {{ ticket.product }}</p>
            <p><b>Reason: </b>{{ ticket.get_reason_display }}</p>
            <p><b>Created date:</b> {{ ticket.opened_date }}
            {% if ticket.closed_date != None %}
                | <b>Closed date:</b> {{ ticket.closed_date }}
            {% endif %}
            </p>
            <p>Last commented by {% last_comment_user ticket %} on {% last_comment_date ticket %}</p>
            <br><br>
            <h4>Comments</h4>
            <table class="table">
                <tbody>
                {% for comment in comments   %}
                <tr><td>
                    <b>{{ comment.user.first_name }} {{ comment.user.last_name }} | {% comment_date_humanized comment%}</b>
                    <br><br>{% autoescape off %}
                    {{ comment.comment }}
                {% endautoescape %}
                    <!-- Comment edit and delete functionality -->
                    {#% if ticket.status != "CLS" %#}
                        {#% if comment.user == user or user.is_staff %#}
                           <!-- <div class="pull-right">
                            <!-- EDIT IS NOT WORKING -->
                            <!-- ####################################
                            <a href="{#% url 'edit-comment' ticket.id comment.id %#}"><i class="fa fa-pencil-square-o"></i></a>
                            <!-- ####################################
                                {#% if ticket.comments.count > 1 %#}
                            <a href="{#% url 'delete-comment' ticket.id comment.id %#}"><i class="fa fa-trash-o"></i></a>
                                    {#% endif %#}
                            </div>-->
                        {#% endif %#}
                    {#% endif %#}
                    <br><br>
                </td></tr>
            {% endfor %}
            </tbody>
            </table>
        </div>
    </div>

{% endblock %}